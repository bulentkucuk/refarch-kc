



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.2">
    
    
      
        <title>Backing Services - Container Shipment EDA reference implementation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#kafka-event-streams" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Container Shipment EDA reference implementation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Container Shipment EDA reference implementation
            </span>
            <span class="md-header-nav__topic">
              
                Backing Services
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Container Shipment EDA reference implementation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Container Shipment EDA reference implementation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Business problem statement
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Business problem statement
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../analysis/readme/" title="Event storming analysis" class="md-nav__link">
      Event storming analysis
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../design/readme/" title="From Analysis to Microservice Specifications" class="md-nav__link">
      From Analysis to Microservice Specifications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../design/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Development practices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Development practices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc-order-ms" title="Order microservice with CQRS and Event Sourcing" class="md-nav__link">
      Order microservice with CQRS and Event Sourcing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc-container-ms/kstreams/" title="Container microservice with event sourcing and Kafka streams" class="md-nav__link">
      Container microservice with event sourcing and Kafka streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc-container-ms/flask" title="Container microservice with Python" class="md-nav__link">
      Container microservice with Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc-container-ms/springboot" title="Container microservice with Springboot - Spring Kafka and PostgreSQL" class="md-nav__link">
      Container microservice with Springboot - Spring Kafka and PostgreSQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../avro/avro/" title="Adopting Schema Registry and Avro" class="md-nav__link">
      Adopting Schema Registry and Avro
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reposlist/" title="Related repositories" class="md-nav__link">
      Related repositories
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Deployments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Deployments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Backing Services
      </label>
    
    <a href="./" title="Backing Services" class="md-nav__link md-nav__link--active">
      Backing Services
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kafka-event-streams" class="md-nav__link">
    Kafka &amp; Event Streams
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-ibm-event-streams-hosted-on-ibm-cloud" class="md-nav__link">
    Using IBM Event Streams, hosted on IBM Cloud
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-deployment" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-kafka-brokers" class="md-nav__link">
    Event Streams Kafka Brokers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-api-key" class="md-nav__link">
    Event Streams API Key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-ibm-event-streams-deployed-on-redhat-openshift-container-platform" class="md-nav__link">
    Using IBM Event Streams, deployed on RedHat OpenShift Container Platform
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-deployment_1" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-kafka-brokers_1" class="md-nav__link">
    Event Streams Kafka Brokers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-api-key_1" class="md-nav__link">
    Event Streams API Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-certificates" class="md-nav__link">
    Event Streams Certificates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-community-based-kafka-helm-charts-deployed-locally-in-cluster" class="md-nav__link">
    Using community-based Kafka Helm charts, deployed locally in-cluster
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-considerations" class="md-nav__link">
    Environment Considerations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-deployment_2" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-brokers" class="md-nav__link">
    Kafka Brokers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql" class="md-nav__link">
    Postgresql
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-postgresql-hosted-on-ibm-cloud" class="md-nav__link">
    Using Postgresql, hosted on IBM Cloud
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-deployment_3" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-postgresql-credentials-as-kubernetes-secrets" class="md-nav__link">
    Creating Postgresql credentials as Kubernetes Secrets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-community-based-postgresql-helm-charts-deployed-locally-in-cluster" class="md-nav__link">
    Using community-based Postgresql Helm charts, deployed locally in-cluster
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-considerations_1" class="md-nav__link">
    Environment Considerations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-deployment_4" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-postgresql-credentials-as-kubernetes-secrets_1" class="md-nav__link">
    Creating Postgresql credentials as Kubernetes Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-debugging-troubleshooting" class="md-nav__link">
    Service Debugging &amp; Troubleshooting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bpm" class="md-nav__link">
    BPM
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application-components/" title="Application Components" class="md-nav__link">
      Application Components
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Integration tests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Integration tests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../itg-tests/itgtests/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../itg-tests/happy-path/happy_path/" title="Happy Path" class="md-nav__link">
      Happy Path
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../itg-tests/saga/saga/" title="Saga Pattern" class="md-nav__link">
      Saga Pattern
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../itg-tests/containerAnomaly/containerAnomaly/" title="Container Anomaly" class="md-nav__link">
      Container Anomaly
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../demo/readme/" title="Demonstration script" class="md-nav__link">
      Demonstration script
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kafka-event-streams" class="md-nav__link">
    Kafka &amp; Event Streams
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-ibm-event-streams-hosted-on-ibm-cloud" class="md-nav__link">
    Using IBM Event Streams, hosted on IBM Cloud
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-deployment" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-kafka-brokers" class="md-nav__link">
    Event Streams Kafka Brokers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-api-key" class="md-nav__link">
    Event Streams API Key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-ibm-event-streams-deployed-on-redhat-openshift-container-platform" class="md-nav__link">
    Using IBM Event Streams, deployed on RedHat OpenShift Container Platform
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-deployment_1" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-kafka-brokers_1" class="md-nav__link">
    Event Streams Kafka Brokers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-api-key_1" class="md-nav__link">
    Event Streams API Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-streams-certificates" class="md-nav__link">
    Event Streams Certificates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-community-based-kafka-helm-charts-deployed-locally-in-cluster" class="md-nav__link">
    Using community-based Kafka Helm charts, deployed locally in-cluster
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-considerations" class="md-nav__link">
    Environment Considerations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-deployment_2" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-brokers" class="md-nav__link">
    Kafka Brokers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql" class="md-nav__link">
    Postgresql
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-postgresql-hosted-on-ibm-cloud" class="md-nav__link">
    Using Postgresql, hosted on IBM Cloud
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-deployment_3" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-postgresql-credentials-as-kubernetes-secrets" class="md-nav__link">
    Creating Postgresql credentials as Kubernetes Secrets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-community-based-postgresql-helm-charts-deployed-locally-in-cluster" class="md-nav__link">
    Using community-based Postgresql Helm charts, deployed locally in-cluster
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-considerations_1" class="md-nav__link">
    Environment Considerations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-deployment_4" class="md-nav__link">
    Service Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-postgresql-credentials-as-kubernetes-secrets_1" class="md-nav__link">
    Creating Postgresql credentials as Kubernetes Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-debugging-troubleshooting" class="md-nav__link">
    Service Debugging &amp; Troubleshooting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bpm" class="md-nav__link">
    BPM
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-kc/edit/master/docs/deployments/backing-services.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Backing Services</h1>
                
                <p>Deployment of backing services for the Event-Driven Architecture Reference Application, which includes Event Streams and Postgresql.  As part of the reference implementation, a Kafka instance is used as the main communication channel for all components of the application, while one of the <a href="https://github.com/ibm-cloud-architecture/refarch-kc-container-ms">components</a> uses Postgresql for it's backing datastore.  You will need these backing services deployed in the cluster or as a public cloud service before the application will run successfully.</p>
<h2 id="kafka-event-streams">Kafka &amp; Event Streams</h2>
<h3 id="using-ibm-event-streams-hosted-on-ibm-cloud">Using IBM Event Streams, hosted on IBM Cloud</h3>
<h4 id="service-deployment">Service Deployment</h4>
<ul>
<li>To provision your service, go to the IBM Cloud Catalog and search for <code>Event Streams</code>. It is in the <em>Integration</em> category. Create the service and specify a name, a region, and a resource group. Once the service is created, you are redirected to the Event Stream Standard Dashboard:</li>
</ul>
<p><img alt="" src="../images/IES-dashboard-std.png" /></p>
<ul>
<li>In the <em>Manage</em> panel add the topics needed for the solution. We need at least the following:</li>
</ul>
<p><img alt="" src="../images/IES-IC-topics.png" /></p>
<ul>
<li>In the Service Credentials tab, create new credentials to get the Kafka broker list, the admim URL and the api_key needed to authenticate the consumers or producers.</li>
</ul>
<p><img alt="" src="../images/IES-IC-credentials.png" /></p>
<h4 id="event-streams-kafka-brokers">Event Streams Kafka Brokers</h4>
<p>Regardless of specific deployment targets (OCP, IKS, k8s), the following prerequisite Kubernetes ConfigMap needs to be created to support the deployments of the application's microservices.  These artifacts need to be created once per unique deployment of the entire application and can be shared between application components in the same overall application deployment.  These values can be acquired from the <code>kafka_brokers_sasl</code> section of the service instance's Service Credentials.</p>
<div class="codehilite"><pre><span></span>kubectl create configmap kafka-brokers --from-literal<span class="o">=</span><span class="nv">brokers</span><span class="o">=</span><span class="s1">&#39;&lt;replace with comma-separated list of brokers&gt;&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
kubectl describe configmap kafka-brokers -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<h4 id="event-streams-api-key">Event Streams API Key</h4>
<p>The Event Streams Broker API Key is needed to connect any deployed consumers or producers to the service in IBM Cloud. To avoid sharing security keys, create a Kubernetes Secret in the target cluster you will deploy the application microservices to.  This is available from the Service Credentials information you just created above.</p>
<div class="codehilite"><pre><span></span>kubectl create secret generic eventstreams-apikey --from-literal<span class="o">=</span><span class="nv">binding</span><span class="o">=</span><span class="s1">&#39;&lt;replace with api key&gt;&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
kubectl describe secret eventstreams-apikey -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<hr />
<h3 id="using-ibm-event-streams-deployed-on-redhat-openshift-container-platform">Using IBM Event Streams, deployed on RedHat OpenShift Container Platform</h3>
<h4 id="service-deployment_1">Service Deployment</h4>
<p>The installation is documented in the <a href="https://ibm.github.io/event-streams/installing/installing-openshift/">product documentation</a> and in our <a href="https://ibm-cloud-architecture.github.io/refarch-eda/deployments/eventstreams/">own note here.</a></p>
<h4 id="event-streams-kafka-brokers_1">Event Streams Kafka Brokers</h4>
<p>Regardless of specific deployment targets (OCP, IKS, k8s), the following prerequisite Kubernetes ConfigMap needs to be created to support the deployments of the application's microservices.  These artifacts need to be created once per unique deployment of the entire application and can be shared between application components in the same overall application deployment.</p>
<div class="codehilite"><pre><span></span>kubectl create configmap kafka-brokers --from-literal<span class="o">=</span><span class="nv">brokers</span><span class="o">=</span><span class="s1">&#39;&lt;replace with comma-separated list of brokers&gt;&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
kubectl describe configmap kafka-brokers -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<h4 id="event-streams-api-key_1">Event Streams API Key</h4>
<p>The Event Streams Broker API Key is needed to connect any deployed consumers or producers to the service running in your cluster. To avoid sharing security keys, create a Kubernetes Secret in the target cluster you will deploy the application microservices to.  You can specify keys at the topic and consumer group levels or use a unique key for all topics and all consumer groups.</p>
<div class="codehilite"><pre><span></span>kubectl create secret generic eventstreams-apikey --from-literal<span class="o">=</span><span class="nv">binding</span><span class="o">=</span><span class="s1">&#39;&lt;replace with api key&gt;&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
kubectl describe secrets -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<h4 id="event-streams-certificates">Event Streams Certificates</h4>
<p>If you are using Event Streams as your Kafka broker provider and it is deployed via the IBM Cloud Pak for Integration (ICP4I), you will need to create an additional Secret to store the generated Certificates &amp; Truststores to connect securely between your application components and the Kafka brokers.  These artifacts need to be created once per unique deployment of the entire application and can be shared between application components in the same overall application deployment.</p>
<ul>
<li>From the <strong>Connect to this cluster</strong> tab on the landing page of your Event Streams installation, download both the <strong>Java truststore</strong> and the <strong>PEM certificate</strong>.</li>
<li>Create the Java truststore Secret:</li>
<li>Command: <code>oc create secret generic &lt;secret-name&gt; --from-file=/path/to/downloaded/file.jks</code></li>
<li>Example: <code>oc create secret generic es-truststore-jks --from-file=/Users/osowski/Downloads/es-cert.jks</code></li>
<li>Create the PEM certificate Secret:</li>
<li>Command: <code>oc create secret generic &lt;secret-name&gt; --from-file=/path/to/downloaded/file.pem</code></li>
<li>Example: <code>oc create secret generic es-ca-pemfile --from-file=/Users/osowski/Downloads/es-cert.pem</code></li>
</ul>
<hr />
<h3 id="using-community-based-kafka-helm-charts-deployed-locally-in-cluster">Using community-based Kafka Helm charts, deployed locally in-cluster</h3>
<p>If you simply want to deploy Kafka using the open source, community-supported Helm Charts, you can do so with the following commands to deploy the <a href="https://bitnami.com/stack/kafka/helm">bitnami Kafka Stack Helm Charts</a>.</p>
<h4 id="environment-considerations">Environment Considerations</h4>
<p>As of the time of this document being authored, the Bitnami Kafka Stack Helm Chart does not expose the required security configuration elements to run optimally on OpenShift.  After generating the Helm templates below, you may need to manually update the YAML files to apply the ServiceAccount you have configured for your environment to run the containers accordingly.</p>
<h4 id="service-deployment_2">Service Deployment</h4>
<ol>
<li>Add Bitnami Helm Repository:
<div class="codehilite"><pre><span></span>helm repo add bitnami https://charts.bitnami.com/bitnami
</pre></div></li>
<li>Update the Helm repository:
<div class="codehilite"><pre><span></span>helm repo update
</pre></div></li>
<li>Create a Kubernetes Namespace or OpenShift Project.
<div class="codehilite"><pre><span></span>kubectl create namespace &lt;target namespace&gt;
</pre></div></li>
<li>Deploy Kafka and Zookeeper using the <code>bitnami/kafka</code> Helm Chart:
<div class="codehilite"><pre><span></span>mkdir bitnami
mkdir templates
helm fetch --untar --untardir bitnami <span class="s1">&#39;bitnami/kafka&#39;</span>
helm template kafka --set persistence.enabled<span class="o">=</span><span class="nb">false</span> --set securityContext.enabled<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --set zookeeper.securityContext.enabled<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  bitnami/kafka --namespace &lt;target namespace&gt; --output-dir templates
<span class="o">(</span>kubectl/oc<span class="o">)</span> apply -R -f templates/
</pre></div>
It will take a few minutes to get the pods ready.</li>
</ol>
<h3 id="kafka-brokers">Kafka Brokers</h3>
<p>Regardless of specific deployment targets (OCP, IKS, k8s), the following prerequisite Kubernetes ConfigMap needs to be created to support the deployments of the application's microservices.  These artifacts need to be created once per unique deployment of the entire application and can be shared between application components in the same overall application deployment.</p>
<div class="codehilite"><pre><span></span>kubectl create configmap kafka-brokers --from-literal<span class="o">=</span><span class="nv">brokers</span><span class="o">=</span><span class="s1">&#39;&lt;replace with comma-separated list of brokers&gt;&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
kubectl describe configmap kafka-brokers -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<hr />
<h2 id="postgresql">Postgresql</h2>
<p>The <a href="https://github.com/ibm-cloud-architecture/refarch-kc-container-ms/">Container Manager microservice</a> persists the Reefer Container inventory in a Postgresql database.  The deployment of Postgresql is only necessary to support the deployment of the Container Manager microservice.  If you are not deploying the Container Manager microservice, you do not need to deploy and configure a Postgresql service and database.</p>
<h3 id="using-postgresql-hosted-on-ibm-cloud">Using Postgresql, hosted on IBM Cloud</h3>
<h4 id="service-deployment_3">Service Deployment</h4>
<p>To install the service, follow the <a href="https://cloud.ibm.com/catalog/services/databases-for-postgresql">product documentation here</a>.</p>
<p>Once the service is deployed, you need to create some service credentials and retreive the following values for the different configurations:</p>
<ul>
<li><code>postgres.username</code></li>
<li><code>postgres.password</code></li>
<li><code>postgres.composed</code>, which will need to be mapped to a JDBC URL in the format of <code>jdbc:postgresql://&lt;hostname&gt;:&lt;port&gt;/&lt;database-name&gt;?sslmode=verify-full&amp;sslfactory=org.postgresql.ssl.NonValidatingFactory</code> <em>(this will remove the <code>username</code> and <code>password</code> values from the default <code>composed</code> string)</em></li>
</ul>
<p><img alt="" src="../images/postgres-credentials.png" /></p>
<h4 id="creating-postgresql-credentials-as-kubernetes-secrets">Creating Postgresql credentials as Kubernetes Secrets</h4>
<ol>
<li>
<p>Applying the same approach as above, copy the Postgresql URL as defined in the Postegresql service credential and execute the following command:
<div class="codehilite"><pre><span></span>kubectl create secret generic postgresql-url --from-literal<span class="o">=</span><span class="nv">binding</span><span class="o">=</span><span class="s1">&#39;&lt;replace with postgresql-url&gt;&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
</pre></div></p>
</li>
<li>
<p>For the user:
<div class="codehilite"><pre><span></span>kubectl create secret generic postgresql-user --from-literal<span class="o">=</span><span class="nv">binding</span><span class="o">=</span><span class="s1">&#39;ibm_cloud_c...&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
</pre></div></p>
</li>
<li>
<p>For the user password:
<div class="codehilite"><pre><span></span>kubectl create secret generic postgresql-pwd --from-literal<span class="o">=</span><span class="nv">binding</span><span class="o">=</span><span class="s1">&#39;&lt;password from the service credential&gt;.&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
</pre></div></p>
</li>
<li>
<p>When running Postgresql through the IBM Cloud service, additional SSL certificates are required to communicate securely:</p>
<ol>
<li>Install the IBM Cloud Database CLI Plugin:
   <div class="codehilite"><pre><span></span>ibmcloud plugin install cloud-databases
</pre></div></li>
<li>Get the certificate using the name of the postgresql service:
  <div class="codehilite"><pre><span></span>ibmcloud cdb deployment-cacert <span class="nv">$IC_POSTGRES_SERV</span> &gt; postgresql.crt
</pre></div></li>
<li>Then add it into an environment variable
  <div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">POSTGRESQL_CA_PEM</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat ./postgresql.crt<span class="k">)</span><span class="s2">&quot;</span>
</pre></div></li>
<li>Then define a secret:
  <div class="codehilite"><pre><span></span>kubectl create secret generic postgresql-ca-pem --from-literal<span class="o">=</span><span class="nv">binding</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$POSTGRESQL_CA_PEM</span><span class="s2">&quot;</span> -n browncompute
</pre></div></li>
</ol>
</li>
</ol>
<hr />
<h3 id="using-community-based-postgresql-helm-charts-deployed-locally-in-cluster">Using community-based Postgresql Helm charts, deployed locally in-cluster</h3>
<p>If you simply want to deploy Postgresql using the open source, community-supported Helm Charts, you can do so with the following commands.</p>
<h4 id="environment-considerations_1">Environment Considerations</h4>
<p>Reference <a href="../application-components/#openshift-container-platform-3-11">Application Components Pre-reqs</a> for details on creating the necessary ServiceAccount with required permissions, prior to deployment.</p>
<h4 id="service-deployment_4">Service Deployment</h4>
<ol>
<li>
<p>Add Bitnami Helm Repository:
<div class="codehilite"><pre><span></span>helm repo add bitnami https://charts.bitnami.com/bitnami
</pre></div></p>
</li>
<li>
<p>Update the Helm repository:
<div class="codehilite"><pre><span></span>helm repo update
</pre></div></p>
</li>
<li>
<p>Create a Kubernetes Namespace or OpenShift Project (if not already created).
<div class="codehilite"><pre><span></span>kubectl create namespace &lt;target namespace&gt;
</pre></div></p>
</li>
<li>Deploy Postgresql using the <code>bitnami/postgresql</code> Helm Chart:
<div class="codehilite"><pre><span></span>mkdir bitnami
mkdir templates
helm fetch --untar --untardir bitnami bitnami/postgresql
helm template --name postgre-db --set <span class="nv">postgresqlPassword</span><span class="o">=</span>supersecret <span class="se">\</span>
  --set persistence.enabled<span class="o">=</span><span class="nb">false</span> --set serviceAccount.enabled<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --set serviceAccount.name<span class="o">=</span>&lt;existing service account&gt; bitnami/postgresql <span class="se">\</span>
  --namespace &lt;target namespace&gt; --output-dir templates
<span class="o">(</span>kubectl/oc<span class="o">)</span> apply -f templates/postgresql/templates
</pre></div>
  It will take a few minutes to get the pods ready.</li>
</ol>
<h4 id="creating-postgresql-credentials-as-kubernetes-secrets_1">Creating Postgresql credentials as Kubernetes Secrets</h4>
<ul>
<li>The <code>postgresql-url</code> needs to point to the in-cluster (non-headless) Kubernetes Service created as part of the deployment and should take the form of the deployment name with the suffix of <code>-postgresql</code>:</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get services <span class="p">|</span> grep postgresql <span class="p">|</span> grep -v headless
kubectl create secret generic postgresql-url --from-literal<span class="o">=</span><span class="nv">binding</span><span class="o">=</span><span class="s1">&#39;jdbc:postgresql://&lt;helm-release-name&gt;-postgresql&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<ul>
<li>For the user:</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl create secret generic postgresql-user --from-literal<span class="o">=</span><span class="nv">binding</span><span class="o">=</span><span class="s1">&#39;postgres&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<ul>
<li>For the user password:</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl create secret generic postgresql-pwd --from-literal<span class="o">=</span><span class="nv">binding</span><span class="o">=</span><span class="s1">&#39;&lt;password used in the helm template command&gt;.&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<h4 id="service-debugging-troubleshooting">Service Debugging &amp; Troubleshooting</h4>
<p>Access to the in-container password can be made using the following command.  This should be the same value you passed in when you deployed the service.</p>
<div class="codehilite"><pre><span></span><span class="n">export</span> <span class="n">POSTGRES_PASSWORD</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">kubectl</span> <span class="k">get</span> <span class="n">secret</span> <span class="c1">--namespace  &lt;target namespace&gt; postgre-db-postgresql -o jsonpath=&quot;{.data.postgresql-password}&quot; | base64 --decode)</span>
</pre></div>

<p>And then use the <code>psql</code> command line interface to interact with postgresql. For that, we use a Docker image as a client to the Postgresql server:</p>
<div class="codehilite"><pre><span></span><span class="n">kubectl</span> <span class="n">run</span> <span class="n">postgre</span><span class="o">-</span><span class="n">db</span><span class="o">-</span><span class="n">postgresql</span><span class="o">-</span><span class="n">client</span> <span class="c1">--rm --tty -i --restart=&#39;Never&#39; --namespace &lt;target namespace&gt; --image bitnami/postgresql:11.3.0-debian-9-r38 --env=&quot;PGPASSWORD=$POSTGRES_PASSWORD&quot; --command -- psql --host postgre-db-postgresql -U postgres -p 5432</span>
</pre></div>

<p>To connect to your database from outside the cluster execute the following commands:</p>
<div class="codehilite"><pre><span></span>    <span class="n">kubectl</span> <span class="n">port</span><span class="o">-</span><span class="k">forward</span> <span class="c1">--namespace &lt;target namespace&gt; svc/postgre-db-postgresql 5432:5432 &amp;&amp;\</span>
    <span class="n">PGPASSWORD</span><span class="o">=</span><span class="ss">&quot;$POSTGRES_PASSWORD&quot;</span> <span class="n">psql</span> <span class="c1">--host 127.0.0.1 -U postgres -p 5432</span>
</pre></div>

<h2 id="bpm">BPM</h2>
<p>The containers microservice component of this Reefer Container EDA reference application can be integrated with a BPM process for the the maintenance of the containers. This BPM process will dispatch a field engineer so that the engineer can go to the reefer container to fix it. The process of scheduling an engineer and then completing the work can best be facilitated through a process based, structured workflow. We will be using IBM BPM on Cloud or Cloud Pak for Automation to best demonstrate the workflow. This workflow can be explored in detail <a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/tree/master/docs/bpm">here</a>.</p>
<p>In order for the containers microservice to fire the BPM workflow, we need to provide the following information through Kubernetes configMaps and secrets:</p>
<ol>
<li>Provide the <strong>BPM authentication login endpoint</strong> and the <strong>BPM workflow endpoint</strong> in a configMap:</li>
</ol>
<div class="codehilite"><pre><span></span>kubectl create configmap bpm-anomaly --from-literal<span class="o">=</span><span class="nv">url</span><span class="o">=</span><span class="s1">&#39;&lt;replace with your BPM workflow endpoint&gt;&#39;</span> --from-literal<span class="o">=</span><span class="nv">login</span><span class="o">=</span><span class="s1">&#39;&lt;replace with your BPM authentication endpoint&gt;&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
kubectl describe configmap bpm-anomaly -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<ol>
<li>Provide your BPM instance's <strong>credentials</strong> in a secret:</li>
</ol>
<div class="codehilite"><pre><span></span>kubectl create secret generic bpm-anomaly --from-literal<span class="o">=</span><span class="nv">user</span><span class="o">=</span><span class="s1">&#39;&lt;replace with your BPM user&gt;&#39;</span> --from-literal<span class="o">=</span><span class="nv">user</span><span class="o">=</span><span class="s1">&#39;&lt;replace with your BPM password&gt;&#39;</span> -n &lt;target k8s namespace / ocp project&gt;
kubectl describe secrets -n &lt;target k8s namespace / ocp project&gt;
</pre></div>

<p><strong>IMPORTANT:</strong> The names for both the secret and configMap (<code>bpm-anomaly</code>) is the default the container microservice uses in its <a href="https://github.com/ibm-cloud-architecture/refarch-kc-container-ms/tree/master/SpringContainerMS/chart/springcontainerms">helm chart</a>. Make sure the name for the configMap and secret you create <strong>match</strong> the names you used in the containers microservice's helm chart.</p>
<p>If you do not have access to any BPM instance with this field engineer dispatching workflow, you can bypass the call to BPM by disabling such call in the container microservice component. For doing so, you can use the following container microservice's API endpoints:</p>
<ol>
<li>Enable BPM: <a href="#bpm"><code>http://&lt;container_microservice_endpoint&gt;/bpm/enable</code></a></li>
<li>Disable BPM: <a href="#bpm"><code>http://&lt;container_microservice_endpoint&gt;/bpm/disable</code></a></li>
<li>BPM status: <a href="#bpm"><code>http://&lt;container_microservice_endpoint&gt;/bpm/status</code></a></li>
</ol>
<p>where <code>&lt;container_microservice_endpoint&gt;</code> is the route, ingress or nodeport service you associated to your container microservice component at deployment time.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../reposlist/" title="Related repositories" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Related repositories
              </span>
            </div>
          </a>
        
        
          <a href="../application-components/" title="Application Components" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Application Components
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c648116f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>